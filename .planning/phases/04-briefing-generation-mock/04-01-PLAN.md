---
phase: 04-briefing-generation-mock
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/webhook/types.go
  - internal/webhook/client.go
  - internal/models/briefing.go
  - internal/config/config.go
autonomous: true

must_haves:
  truths:
    - "Webhook client returns mock BriefingContent in stub mode without making HTTP calls"
    - "Webhook client sends X-N8N-SECRET header when not in stub mode"
    - "BriefingContent struct has typed News, Weather, Work sections"
    - "Config reads N8N_WEBHOOK_URL, N8N_WEBHOOK_SECRET, N8N_STUB_MODE from environment"
  artifacts:
    - path: "internal/webhook/types.go"
      provides: "BriefingContent, NewsItem, WeatherInfo, WorkSummary types"
      contains: "BriefingContent"
    - path: "internal/webhook/client.go"
      provides: "Webhook client with stub mode and X-N8N-SECRET header"
      contains: "X-N8N-SECRET"
    - path: "internal/models/briefing.go"
      provides: "GeneratedAt field on Briefing model"
      contains: "GeneratedAt"
    - path: "internal/config/config.go"
      provides: "N8N webhook configuration fields"
      contains: "N8NWebhookURL"
  key_links:
    - from: "internal/webhook/client.go"
      to: "internal/webhook/types.go"
      via: "returns *BriefingContent"
      pattern: "BriefingContent"
---

<objective>
Create the webhook client package and briefing content types that the worker and handlers will use.

Purpose: Establishes the domain types (BriefingContent with News/Weather/Work sections) and the n8n webhook client with stub mode support. This is the foundation layer that Plan 02 builds on for handlers, worker logic, and UI.

Output: `internal/webhook/` package with client and types, updated Briefing model with GeneratedAt, config fields for n8n integration.
</objective>

<execution_context>
@/Users/jim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-briefing-generation-mock/04-RESEARCH.md
@internal/models/briefing.go
@internal/config/config.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create webhook package with types and stub-mode client</name>
  <files>internal/webhook/types.go, internal/webhook/client.go</files>
  <action>
Create `internal/webhook/types.go` with these types (all JSON-tagged for marshaling):

- `BriefingContent` struct with fields: `News []NewsItem`, `Weather WeatherInfo`, `Work WorkSummary`
- `NewsItem` struct with fields: `Title string`, `Summary string`, `URL string`
- `WeatherInfo` struct with fields: `Location string`, `Temperature int`, `Condition string`
- `WorkSummary` struct with fields: `TodayEvents []string`, `TomorrowTasks []string`

Create `internal/webhook/client.go` with:

- `Client` struct with fields: `baseURL string`, `secret string`, `httpClient *http.Client`, `stubMode bool`
- `NewClient(baseURL, secret string, stubMode bool) *Client` constructor. MUST create custom `http.Client{Timeout: 30 * time.Second}` -- never use `http.DefaultClient` (can hang indefinitely per research pitfall 4).
- `GenerateBriefing(ctx context.Context, userID uint) (*BriefingContent, error)` method:
  - If `stubMode` is true: return hardcoded mock data immediately (2 news items, weather for San Francisco 65F Partly Cloudy, 3 today events, 3 tomorrow tasks). Add a small `time.Sleep(2 * time.Second)` to simulate processing delay so the polling UI is visible during demos.
  - If `stubMode` is false: create POST request to `c.baseURL + "/generate"` with `http.NewRequestWithContext(ctx, ...)`. Set headers: `X-N8N-SECRET` = `c.secret`, `Content-Type` = `application/json`. Execute with `c.httpClient.Do(req)`. Check for non-200 status. Decode JSON response body into `BriefingContent`. Return result.

Follow existing codebase patterns: package comment, standard Go import grouping (stdlib, external, internal), exported types with PascalCase.
  </action>
  <verify>
Run `go build ./internal/webhook/...` -- must compile without errors.
Run `go vet ./internal/webhook/...` -- must pass.
  </verify>
  <done>
`internal/webhook/` package exists with `Client` struct that returns mock `BriefingContent` in stub mode and sends authenticated HTTP requests in production mode. Compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Extend Briefing model and config for n8n integration</name>
  <files>internal/models/briefing.go, internal/config/config.go</files>
  <action>
Update `internal/models/briefing.go`:
- Add `GeneratedAt *time.Time` field to the Briefing struct (after ErrorMessage, before ReadAt). No GORM tag needed -- defaults are fine.
- The existing `Content datatypes.JSON` field is sufficient for now. We will marshal `BriefingContent` to JSON and store it. Do NOT change the field type to `datatypes.JSONType[T]` because that requires additional GORM datatypes imports and the raw `datatypes.JSON` works well enough for Phase 4 (can upgrade in Phase 5 if needed).

Update `internal/config/config.go`:
- Add three new fields to the Config struct: `N8NWebhookURL string`, `N8NWebhookSecret string`, `N8NStubMode bool`.
- In `Load()`, read from environment: `N8N_WEBHOOK_URL` via `os.Getenv`, `N8N_WEBHOOK_SECRET` via `os.Getenv`, `N8N_STUB_MODE` via `getEnvWithDefault("N8N_STUB_MODE", "true")` -- default to stub mode (safe default for development).
- Parse `N8NStubMode`: if env value is `"true"` or `"1"` set to `true`, otherwise `false`. Use `strings.EqualFold` or simple comparison.
- Do NOT add production warnings for missing n8n config -- it's optional since stub mode is the default.
  </action>
  <verify>
Run `go build ./internal/models/... ./internal/config/...` -- must compile without errors.
Run `go vet ./internal/models/... ./internal/config/...` -- must pass.
  </verify>
  <done>
Briefing model has `GeneratedAt` field. Config reads `N8N_WEBHOOK_URL`, `N8N_WEBHOOK_SECRET`, `N8N_STUB_MODE` from environment with stub mode defaulting to true.
  </done>
</task>

</tasks>

<verification>
- `go build ./...` compiles the entire project without errors
- `go vet ./...` passes
- `internal/webhook/types.go` defines BriefingContent, NewsItem, WeatherInfo, WorkSummary
- `internal/webhook/client.go` has NewClient constructor and GenerateBriefing method with stub mode branch
- `internal/models/briefing.go` has GeneratedAt field
- `internal/config/config.go` has N8NWebhookURL, N8NWebhookSecret, N8NStubMode fields
</verification>

<success_criteria>
Webhook client package compiles and provides typed briefing content. Config reads n8n environment variables. Briefing model has GeneratedAt timestamp. All existing tests pass. Project builds cleanly.
</success_criteria>

<output>
After completion, create `.planning/phases/04-briefing-generation-mock/04-01-SUMMARY.md`
</output>
