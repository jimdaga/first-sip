---
phase: 05-briefing-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/briefings/templates.templ
  - internal/briefings/handlers.go
  - internal/templates/dashboard.templ
  - cmd/server/main.go
autonomous: true

must_haves:
  truths:
    - "Briefing sections (News/Weather/Work) display in distinct visual cards with background color and rounded corners"
    - "Dashboard layout is responsive — content is readable on mobile (320px+) and desktop"
    - "DaisyUI badge shows Unread (badge-error) when ReadAt is nil, Read (badge-success) when ReadAt is set"
    - "User can click completed briefing card to mark it as read"
    - "Marking as read is idempotent — clicking an already-read briefing does not error or change timestamp"
  artifacts:
    - path: "internal/briefings/templates.templ"
      provides: "Enhanced BriefingCard with read/unread badge, click-to-mark-read hx-post, responsive classes on content sections"
      contains: "badge badge-error"
    - path: "internal/briefings/handlers.go"
      provides: "MarkBriefingReadHandler that updates ReadAt and returns updated card HTML"
      exports: ["MarkBriefingReadHandler"]
    - path: "internal/templates/dashboard.templ"
      provides: "Mobile-responsive container with responsive padding and max-width"
      contains: "max-w-4xl"
    - path: "cmd/server/main.go"
      provides: "Route wiring for POST /api/briefings/:id/read"
      contains: "/api/briefings/:id/read"
  key_links:
    - from: "internal/briefings/templates.templ"
      to: "/api/briefings/:id/read"
      via: "hx-post on completed briefing card"
      pattern: "hx-post.*briefings.*read"
    - from: "cmd/server/main.go"
      to: "internal/briefings/handlers.go"
      via: "route registration calling MarkBriefingReadHandler"
      pattern: "briefings\\.MarkBriefingReadHandler"
    - from: "internal/briefings/handlers.go"
      to: "models.Briefing.ReadAt"
      via: "GORM Update of read_at field"
      pattern: "Update.*read_at"
---

<objective>
Enhance the existing briefing UI to be mobile-responsive with distinct visual sections, add read/unread state badges, and implement click-to-mark-read functionality.

Purpose: Satisfy BDISP-01 (distinct sections), BDISP-02 (mobile-responsive), BDISP-03 (read/unread state) requirements. This completes the briefing display phase — the Briefing model already has a ReadAt field from Phase 2 migrations.

Output: Updated briefing templates with responsive layout, read/unread indicators, mark-read handler, and route wiring.
</objective>

<execution_context>
@/Users/jim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-briefing-display/05-RESEARCH.md
@internal/briefings/templates.templ
@internal/briefings/handlers.go
@internal/templates/dashboard.templ
@cmd/server/main.go
@internal/models/briefing.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MarkBriefingReadHandler and wire route</name>
  <files>internal/briefings/handlers.go, cmd/server/main.go</files>
  <action>
  In `internal/briefings/handlers.go`, add a new `MarkBriefingReadHandler(db *gorm.DB) gin.HandlerFunc` function. This handler:
  1. Parses briefing ID from `c.Param("id")`
  2. Queries the briefing from DB using `db.First(&briefing, briefingID)`
  3. Returns 404 if not found
  4. Checks `briefing.ReadAt == nil` — only updates if not already read (idempotent)
  5. If unread: sets `now := time.Now()`, calls `db.Model(&briefing).Update("read_at", now)`, sets `briefing.ReadAt = &now`
  6. Returns the updated BriefingCard HTML fragment via `c.Header("Content-Type", "text/html")` and `BriefingCard(briefing).Render(c.Request.Context(), c.Writer)`

  Add the `"time"` import to the import block.

  In `cmd/server/main.go`, add the new route inside the `protected` group (after the existing briefing routes):
  ```
  protected.POST("/api/briefings/:id/read", briefings.MarkBriefingReadHandler(db))
  ```

  Follow the same handler factory pattern used by `CreateBriefingHandler` and `GetBriefingStatusHandler`. Error handling should return an HTML alert div, matching existing convention.
  </action>
  <verify>Run `cd /Users/jim/git/jimdaga/first-sip && make build` to confirm compilation succeeds. Run `grep -n "MarkBriefingReadHandler" cmd/server/main.go internal/briefings/handlers.go` to confirm route wiring and handler exist.</verify>
  <done>MarkBriefingReadHandler exists in handlers.go, POST /api/briefings/:id/read route is wired in main.go, project compiles without errors.</done>
</task>

<task type="auto">
  <name>Task 2: Enhance templates with responsive layout, read/unread badge, click-to-mark-read</name>
  <files>internal/briefings/templates.templ, internal/templates/dashboard.templ</files>
  <action>
  **In `internal/templates/dashboard.templ`**, make the layout mobile-responsive:
  - Change the container div from `class="container mx-auto p-8"` to `class="container mx-auto p-4 md:p-8 max-w-4xl"`
  - Change the heading from `class="text-3xl font-bold mb-6"` to `class="text-2xl md:text-3xl font-bold mb-4 md:mb-6"`
  - Add `w-full md:w-auto` to the Generate button so it spans full width on mobile
  - Change the empty-state div to include `text-center md:text-left`

  **In `internal/briefings/templates.templ`**, enhance the BriefingCard completed state:

  1. **Add click-to-mark-read on the completed card div:**
     - Add `cursor-pointer hover:shadow-2xl transition-shadow` to the card class
     - Add `hx-post={ fmt.Sprintf("/api/briefings/%d/read", briefing.ID) }` attribute
     - Add `hx-target="#briefing-area"` and `hx-swap="outerHTML"` attributes

  2. **Add read/unread badge in the card header:**
     Replace the existing `<div class="badge badge-success">Completed</div>` with a conditional:
     ```
     if briefing.ReadAt == nil {
       <span class="badge badge-error">Unread</span>
     } else {
       <span class="badge badge-success">Read</span>
     }
     ```

  3. **Add responsive padding to the completed card body:**
     Change `card-body` to `card-body p-4 md:p-6`

  4. **Make content sections visually distinct with responsive classes:**
     In `renderContent`, update the sections container from `class="space-y-4 mt-4"` to `class="space-y-4 md:space-y-6 mt-4"`.

     Wrap each section (News, Weather, Work) in a distinct visual card:
     - News section: wrap content in `<div class="bg-base-200 p-3 md:p-4 rounded-lg">`, add emoji to heading: `"News"` becomes a heading with a news emoji prefix. Change `<h4 class="text-lg font-semibold mb-2">` to `<h4 class="text-base md:text-lg font-semibold mb-2 md:mb-3">`
     - Weather section: same bg-base-200 pattern. Change text sizing to `text-sm md:text-base`
     - Work section: same bg-base-200 pattern. Change heading for "Today's Schedule" to "Work" with work emoji. Add `text-xs md:text-sm` to list items. Add `truncate md:whitespace-normal` to list items for mobile overflow protection.

     Update news item links to use `text-sm md:text-base` and add `line-clamp-2 md:line-clamp-3` to summary paragraphs.

     Update the border-left on news items from `pl-4` to `pl-3 md:pl-4`.

  After modifying the .templ files, run `templ generate` to regenerate the Go files.

  IMPORTANT: Do NOT add hx-post or click behavior to pending/processing or failed states — only the completed state should have click-to-mark-read.
  </action>
  <verify>
  Run `cd /Users/jim/git/jimdaga/first-sip && templ generate && make build` to confirm templ generation and compilation succeed.
  Run `grep -n "badge-error\|badge-success\|hx-post.*read\|max-w-4xl\|bg-base-200" internal/briefings/templates.templ internal/templates/dashboard.templ` to confirm all enhancements are present.
  </verify>
  <done>
  BriefingCard completed state shows Unread badge (badge-error) when ReadAt is nil, Read badge (badge-success) when ReadAt is set. Clicking the completed card triggers POST to /api/briefings/:id/read. Content sections (News/Weather/Work) have bg-base-200 backgrounds with rounded corners as distinct visual cards. Dashboard container has max-w-4xl and responsive padding. All text sizes use mobile-first responsive classes. Project compiles without errors.
  </done>
</task>

</tasks>

<verification>
1. `make build` succeeds — project compiles with all template and handler changes
2. `grep "MarkBriefingReadHandler" internal/briefings/handlers.go` — handler exists
3. `grep "/api/briefings/:id/read" cmd/server/main.go` — route is wired
4. `grep "badge-error" internal/briefings/templates.templ` — unread badge exists
5. `grep "badge-success" internal/briefings/templates.templ` — read badge exists
6. `grep "hx-post.*read" internal/briefings/templates.templ` — click-to-mark-read wired
7. `grep "bg-base-200" internal/briefings/templates.templ` — distinct section backgrounds
8. `grep "max-w-4xl" internal/templates/dashboard.templ` — responsive container
9. `grep "md:p-8" internal/templates/dashboard.templ` — responsive padding
10. `grep "line-clamp" internal/briefings/templates.templ` — text truncation for mobile
</verification>

<success_criteria>
- Briefing sections render in visually distinct cards (bg-base-200 backgrounds, rounded-lg corners, responsive padding)
- Dashboard uses mobile-first responsive layout (full-width button on mobile, constrained max-w-4xl container)
- Completed briefing card shows Unread/Read badge based on ReadAt field
- Clicking a completed briefing card triggers POST /api/briefings/:id/read and swaps to updated card with Read badge
- Handler is idempotent — repeated clicks on already-read briefing return same card without DB update
- All text uses responsive sizing (text-sm md:text-base patterns)
- Project builds successfully with `make build`
</success_criteria>

<output>
After completion, create `.planning/phases/05-briefing-display/05-01-SUMMARY.md`
</output>
